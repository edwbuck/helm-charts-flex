suite: "test server with .server.image.tag \"latest\""
templates:
  - "server-statefulset.yaml"
tests:
  - it: "image value should be \"ghcr.io/spiffe/spire-server:latest\""
    template: "server-statefulset.yaml"
    set:
      trustdomain: "dev.mycorp.com"
      server.image.tag: "latest"
    asserts:
      - containsDocument:
          apiVersion: "apps/v1"
          kind: "StatefulSet"
          name: "RELEASE-NAME-server-statefulset"
          namespace: "NAMESPACE"
      - equal:
          path: spec.template.spec.containers[?(@.name == "RELEASE-NAME-server")].image
          value: "ghcr.io/spiffe/spire-server:latest"
