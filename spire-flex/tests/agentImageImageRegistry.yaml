suite: test agent with .image.registry docker
templates:
  - agent-daemonset.yaml
tests:
  - it: "Demonstrates the use of an override image registry"
    template: agent-daemonset.yaml
    set:
      image.registry: "docker"
    asserts:
      - containsDocument:
          apiVersion: "apps/v1"
          kind: "DaemonSet"
          name: "RELEASE-NAME-agent-daemonset"
          namespace: "NAMESPACE"
      - isNotNull:
          path: spec
      - isNotNull:
          path: spec.template
      - isNotNull:
          path: spec.template.spec
      - isNotNull:
          path: spec.template.spec.containers
      - isNotNull:
          path: spec.template.spec.containers[?(@.name == "RELEASE-NAME-agent")].image
      - equal:
          path: spec.template.spec.containers[?(@.name == "RELEASE-NAME-agent")].image
          value: "docker/spiffe/spire-agent:1.8.0"
